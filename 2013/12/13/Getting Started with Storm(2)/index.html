<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.3.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.ico">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.ico">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">

<link rel="stylesheet" href="//fonts.googleapis.com/css?family=Times+New+Roman:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext">

<link rel="stylesheet" href="//cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.0/css/all.min.css">
  <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.css">

<script class="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"www.liuyong.online","root":"/","scheme":"Muse","version":"8.0.1","exturl":false,"sidebar":{"position":"left","width":240,"display":"always","padding":18,"offset":0},"copycode":true,"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":true,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":"utteranc","storage":true,"lazyload":false,"nav":null},"motion":{"enable":false,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"},"path":"/search.xml","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false}};
  </script>

  <meta property="og:type" content="article">
<meta property="og:title" content="Getting Started with Storm(2)">
<meta property="og:url" content="https://www.liuyong.online/2013/12/13/Getting%C2%A0Started%C2%A0with%C2%A0Storm(2)/">
<meta property="og:site_name" content="劉勇の博客">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://simg.sinajs.cn/blog7style/images/common/sg_trans.gif">
<meta property="og:image" content="http://simg.sinajs.cn/blog7style/images/common/sg_trans.gif">
<meta property="og:image" content="http://simg.sinajs.cn/blog7style/images/common/sg_trans.gif">
<meta property="article:published_time" content="2013-12-13T14:58:00.000Z">
<meta property="article:modified_time" content="2022-10-27T12:22:29.016Z">
<meta property="article:author" content="Ryle Liu">
<meta property="article:tag" content="storm">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://simg.sinajs.cn/blog7style/images/common/sg_trans.gif">


<link rel="canonical" href="https://www.liuyong.online/2013/12/13/Getting%C2%A0Started%C2%A0with%C2%A0Storm(2)/">


<script class="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title>Getting Started with Storm(2) | 劉勇の博客</title>
  






  <noscript>
  <style>
  body { margin-top: 2rem; }

  .use-motion .menu-item,
  .use-motion .sidebar,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header {
    visibility: visible;
  }

  .use-motion .header,
  .use-motion .site-brand-container .toggle,
  .use-motion .footer { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle,
  .use-motion .custom-logo-image {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line {
    transform: scaleX(1);
  }

  .search-pop-overlay, .sidebar-nav { display: none; }
  .sidebar-panel { display: block; }
  </style>
</noscript>

<link rel="alternate" href="/atom.xml" title="劉勇の博客" type="application/atom+xml">
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="bodystyle">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">
      <img class="custom-logo-image" src="/images/logo.png" alt="劉勇の博客">
    
    <a href="/" class="brand" rel="start">
    <!--  <i class="logo-line"></i> -->
      <h1 class="site-title">劉勇の博客</h1>
    <!--  <i class="logo-line"></i> -->
    </a>
  </div>
</div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>

 
<nav class="site-nav">
  <ul class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
        <li class="menu-item menu-item-schedule">

    <a href="/schedule/" rel="section"><i class="fa fa-calendar fa-fw"></i>日程表</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a>

  </li>
        <li class="menu-item menu-item-commonweal">

    <a href="/404/" rel="section"><i class="fa fa-heartbeat fa-fw"></i>公益 404</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>


  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off" maxlength="80"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div class="search-result-container no-result">
  <div class="search-result-icon">
    <i class="fa fa-spinner fa-pulse fa-5x"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>
        
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-overview-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <section class="post-toc-wrap sidebar-panel">
      </section>
      <!--/noindex-->

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Ryle Liu"
      src="/images/lvlogo.png">
  <p class="site-author-name" itemprop="name">Ryle Liu</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">190</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">8</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">144</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author site-overview-item animated">
      <span class="links-of-author-item">
        <a href="https://github.com/ryle2020" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;ryle2020" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i></a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:ryle@2ndlife.cn" title="E-Mail → mailto:ryle@2ndlife.cn" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i></a>
      </span>
      <span class="links-of-author-item">
        <a href="https://weibo.com/liusanrong" title="Weibo → https:&#x2F;&#x2F;weibo.com&#x2F;liusanrong" rel="noopener" target="_blank"><i class="fab fa-weibo fa-fw"></i></a>
      </span>
  </div>


  <div class="links-of-blogroll site-overview-item animated">
    <div class="links-of-blogroll-title"><i class="fa fa-globe fa-fw"></i>
      Links
    </div>
    <ul class="links-of-blogroll-list">
        <li class="links-of-blogroll-item">
          <a href="https://www.liu.group/" title="https:&#x2F;&#x2F;www.liu.group" rel="noopener" target="_blank">第二人生</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="https://thinkphp.cn/" title="https:&#x2F;&#x2F;thinkphp.cn" rel="noopener" target="_blank">ThinkPHP</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="https://kancloud.cn/" title="https:&#x2F;&#x2F;kancloud.cn" rel="noopener" target="_blank">看云</a>
        </li>
    </ul>
  </div>

      </section>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>
  <div class="reading-progress-bar"></div>

  <a href="https://github.com/ryle2020" class="github-corner" title="Follow me on GitHub" aria-label="Follow me on GitHub" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner post posts-expand">
      

      

  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://www.liuyong.online/2013/12/13/Getting%C2%A0Started%C2%A0with%C2%A0Storm(2)/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/lvlogo.png">
      <meta itemprop="name" content="Ryle Liu">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="劉勇の博客">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          Getting Started with Storm(2)
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2013-12-13 22:58:00" itemprop="dateCreated datePublished" datetime="2013-12-13T22:58:00+08:00">2013-12-13</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/programer/" itemprop="url" rel="index"><span itemprop="name">程序人生</span></a>
        </span>
    </span>

  
    <span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">阅读次数：</span>
      <span id="busuanzi_value_page_pv"></span>
    </span>
     <!-- </div> -->
     <!-- <div class="post-meta"> -->
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>13k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>12 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
        <div style="font-family: 微软雅黑; line-height: normal;">
<a id="more"></a>
<b><font style="font-size: 18px;">第二章</font></b>
<div style="font-family: 微软雅黑; line-height: normal;">
这一章，我们将会创建一个Storm项目及第一个Storm
topology，需要我们事先安装好JRE1.6或者更高版本。建议从oracle的<a target="_blank" rel="noopener" href="http://www.java.com/downloads/">http://www.java.com/downloads/</a>去下载
<div style="font-family: 微软雅黑; line-height: normal;">
<div style="font-family: 微软雅黑; line-height: normal;">
<div style="font-family: 微软雅黑; line-height: normal;">
<b><font style="font-size: 16px;">Operation Modes</font></b>
<div style="font-family: 微软雅黑; line-height: normal;">
在开始之前，我们需要理解Storm的Operation Modes，有两种模式，Local Mode和Remote
ode
<div style="font-family: 微软雅黑; line-height: normal;">
<div style="font-family: 微软雅黑; line-height: normal;"><u><b>Local
ode</b></u>
<div style="font-family: 微软雅黑; line-height: normal;">在Local
ode，Strom
topology在本地机器的单一的JVM中运行。此模式主要用于开发、测试以及调试，主要是比较容易看到所有的topology组件一起工作的状态。在此模式下，我们可以通过调整参数来观察我们的topology在各种不同的Storm配置环境中的运行。为了在Local
ode中运行topology，我们需要下载Storm开发依赖包，包含了开发和测试所有必备的条目。我们在创建第一个Storm项目时候会看到这一些有多简单。在Local
ode运行topology和在Storm集群中运行是很相似的。但我们需要确保所有的组件都是线程安全的，因为当这些组件被部署到Remote
ode的时候，他们可能会运行在不同的JVMs，甚至不同的物理机器上，这时候是没有直接的通信或者共享的内存的。此章所有的例子都运行在Local
ode下。
<div style="font-family: 微软雅黑; line-height: normal;">
<div style="font-family: 微软雅黑; line-height: normal;"><u><b>Remote
ode</b></u>
<div style="font-family: 微软雅黑; line-height: normal;">在Remote
ode，我们提交我们的topology到Storm集群，一般而言，Strom集群可以有许多运行在不同的机器上的进程组成。Remote
ode不会显示调试信息，这也是为什么被认为是Production
ode的原因。然而，在一台开发机器上创建一个Storm集群也是可能的，而且在正式部署到生产环境是这么做是一个非常好的做法，可以确保在生产环境部署的时候不会有问题。第六章会更多地说明Remote
ode，在附录B会说明怎么安装一个集群。
<div style="font-family: 微软雅黑; line-height: normal;">
<div style="font-family: 微软雅黑; line-height: normal;"><b><u>Hello
Word Storm</u></b>
<div style="font-family: 微软雅黑; line-height: normal;">
我们会创建一个简单的topolgy来计算单词的项目，我们把这个项目称为Storm topology的Hello
World。不过这也是一个非常强大的topology因为事实上这个topology可以被无限制的扩展，稍做修改甚至我们可以做一个统计系统。比如我们可以修改一下用来挖据Twitter的主题的趋势。
<div style="font-family: 微软雅黑; line-height: normal;">
<div style="font-family: 微软雅黑; line-height: normal;">
为了创建这个Topology，我们会用一个Spout来负责读入单词，第一个Bolt负责标准化单词，第二个Bolt负责计算单词次数，如下图所示：
<div style="font-family: 微软雅黑; line-height: normal;"><a href="http://album.sina.com.cn/pic/001DcOacgy6EY6A8Vgi16" target="_blank"><img alt="Getting &lt;wbr&gt;Started &lt;wbr&gt;with &lt;wbr&gt;Storm(2)" name="image_operate_27211386947276109" real_src="http://s7.sinaimg.cn/bmiddle/001DcOacgy6EY6A8Vgi16&amp;690" src="http://simg.sinajs.cn/blog7style/images/common/sg_trans.gif" title="Getting &lt;wbr&gt;Started &lt;wbr&gt;with &lt;wbr&gt;Storm(2)"/></a>
可以在<a target="_blank" rel="noopener" href="https://github.com/storm-book/examples-ch02-getting_started/zipball/masteri">https://github.com/storm-book/examples-ch02-getting_started/zipball/masteri</a>下载源代码
<div style="font-family: 微软雅黑; line-height: normal;">
如果你使用git（一个分布式的版本控制和源代码管理工具），可以在你想要下载源代码的目录中运行：git clone
git@github.com:storm-book/examples-ch02-getting_started.git
<div style="font-family: 微软雅黑; line-height: normal;">
<div style="font-family: 微软雅黑; line-height: normal;">
<u><b>检测java</b></u>
<div style="font-family: 微软雅黑; line-height: normal;">
配置环境的第一步是检查使用的java的版本。可以在命令行窗口中运行： java
-version，可以得到类似下图的信息：<img alt="Getting &lt;wbr&gt;Started &lt;wbr&gt;with &lt;wbr&gt;Storm(2)" data-inited="true" data-media-type="image" style="cursor: default; display: inline-block;" title="Getting &lt;wbr&gt;Started &lt;wbr&gt;with &lt;wbr&gt;Storm(2)"/>
<div style="font-family: 微软雅黑; line-height: normal;">
<img alt="Getting &lt;wbr&gt;Started &lt;wbr&gt;with &lt;wbr&gt;Storm(2)" data-inited="true" data-media-type="image" style="cursor: default; display: inline-block;" title="Getting &lt;wbr&gt;Started &lt;wbr&gt;with &lt;wbr&gt;Storm(2)"/>
<div style="font-family: 微软雅黑; line-height: normal;"><a href="http://album.sina.com.cn/pic/001DcOacgy6EY6HCihA4a" target="_blank"><img alt="Getting &lt;wbr&gt;Started &lt;wbr&gt;with &lt;wbr&gt;Storm(2)" name="image_operate_43831386947280727" real_src="http://s11.sinaimg.cn/mw690/001DcOacgy6EY6HCihA4a&amp;690" src="http://simg.sinajs.cn/blog7style/images/common/sg_trans.gif" title="Getting &lt;wbr&gt;Started &lt;wbr&gt;with &lt;wbr&gt;Storm(2)"/></a>
<div style="font-family: 微软雅黑; line-height: normal;">
<u><b>创建项目</b></u>
<div style="font-family: 微软雅黑; line-height: normal;">
为了开始此项目，创建一个放应用的目录，将此项目的源代码放在此目录。然后我们需要下载Storm所有的依赖包：是一组jar包，我们需要将其加入此应用的classpath。有两种做法：
<div style="font-family: 微软雅黑; line-height: normal;">
<ul>
<li>下载所有的依赖包，解压缩然后加入classpath</li>
<li>或者使用Apache
aven。Maven是软件项目管理工具，可以用来管理项目开发周期中的几个方面，从依赖包到发布流程。在此书，我们将广泛使用Maven。请使用mvn命令来检查是否安装了Maven。可以到<a target="_blank" rel="noopener" href="http://maven.apache.org/download.html">http://maven.apache.org/download.html</a>去下载Maven。尽管使用Storm不需要你是一个Maven专家，不过了解Maven是非常有用的。</li>
</ul>
<span style="font-family: 微软雅黑; line-height: normal;">我们需要创建一个pom.xml（Project
Object
odel）文件来定义项目结构，会描述例如依赖关系，包，源代码等。我们将使用由nathanmarz创建的依赖和Maven库(</span><a target="_blank" rel="noopener" href="https://github.com/nathanmarz/">https://github.com/nathanmarz/</a><span style="font-family: 微软雅黑; line-height: normal;">)。所有这些依赖包可以在</span><a target="_blank" rel="noopener" href="https://github.com/nzthanmarz/storm/wiki/Maven">https://github.com/nzthanmarz/storm/wiki/Maven</a><span style="font-family: 微软雅黑; line-height: normal;">找到。在Local
ode运行Storm的话需要所有这些依赖包。</span><br style="font-family: 微软雅黑; line-height: normal;"/>
<blockquote style="font-family: 微软雅黑; line-height: normal; margin: 0px 0px 0px 40px; border: none; padding: 0px;">
</blockquote>
<div style="font-family: 微软雅黑; line-height: normal;">
使用这些依赖包，我们可以写一个包含运行topology的最基本组件的pom.xml:
<div style="font-family: 微软雅黑; line-height: normal;">
<div style="font-family: 微软雅黑; line-height: normal;">
xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
<div style="font-family: 微软雅黑; line-height: normal;">
xsi:schemaLocation="http://maven.apache.org/POM/4.0.0
<div style="font-family: 微软雅黑; line-height: normal;">
http://maven.apache.org/xsd/maven-4.0.0.xsd"&gt;
<div style="font-family: 微软雅黑; line-height: normal;">4.0.0
<div style="font-family: 微软雅黑; line-height: normal;">
storm.book
<div style="font-family: 微软雅黑; line-height: normal;">
Getting-Started
<div style="font-family: 微软雅黑; line-height: normal;">
0.0.1-SNAPSHOT
<div style="font-family: 微软雅黑; line-height: normal;">
<div style="font-family: 微软雅黑; line-height: normal;">
<div style="font-family: 微软雅黑; line-height: normal;">
<div style="font-family: 微软雅黑; line-height: normal;">
org.apache.maven.plugins
<div style="font-family: 微软雅黑; line-height: normal;">
maven-compiler-plugin
<div style="font-family: 微软雅黑; line-height: normal;">2.3.2
<div style="font-family: 微软雅黑; line-height: normal;">
<div style="font-family: 微软雅黑; line-height: normal;">1.6
<div style="font-family: 微软雅黑; line-height: normal;">1.6
<div style="font-family: 微软雅黑; line-height: normal;">1.6
<div style="font-family: 微软雅黑; line-height: normal;">
<div style="font-family: 微软雅黑; line-height: normal;">
<div style="font-family: 微软雅黑; line-height: normal;">
<div style="font-family: 微软雅黑; line-height: normal;">
<div style="font-family: 微软雅黑; line-height: normal;">
<div style="font-family: 微软雅黑; line-height: normal;">
<div style="font-family: 微软雅黑; line-height: normal;">
<div style="font-family: 微软雅黑; line-height: normal;">
clojars.org
<div style="font-family: 微软雅黑; line-height: normal;">
http://clojars.org/repo
<div style="font-family: 微软雅黑; line-height: normal;">
<div style="font-family: 微软雅黑; line-height: normal;">
<div style="font-family: 微软雅黑; line-height: normal;">
<div style="font-family: 微软雅黑; line-height: normal;">
<div style="font-family: 微软雅黑; line-height: normal;">
<div style="font-family: 微软雅黑; line-height: normal;">storm
<div style="font-family: 微软雅黑; line-height: normal;">storm
<div style="font-family: 微软雅黑; line-height: normal;">0.6.0
<div style="font-family: 微软雅黑; line-height: normal;">
<div style="font-family: 微软雅黑; line-height: normal;">
<div style="font-family: 微软雅黑; line-height: normal;">
<div style="font-family: 微软雅黑; line-height: normal;">
<div style="font-family: 微软雅黑; line-height: normal;">最初的
几行定义了项目的名字和版本，然后我们增加了一个编译器插件，告诉Maven我们的源代码需要被java1.6去编译。记者我们定义了代码库（Maven可以支持对同一个项目的多个代码库）。clojars是所有Storm的依赖包的代码库。Maven会自动下载Storm在Local
ode运行所需要的所有依赖包和子包。
<div style="font-family: 微软雅黑; line-height: normal;">
<div style="font-family: 微软雅黑; line-height: normal;">
(*增加对于Maven的POM的说明：
<div style="font-family: 微软雅黑; line-height: normal;">
<div style="font-family: 微软雅黑; line-height: normal;">
xmlns等主要是POM相关的命名空间以及xsd元素；
<div style="font-family: 微软雅黑; line-height: normal;">
modelVersion指定了当前POM模型的版本；
<div style="font-family: 微软雅黑; line-height: normal;">
下面是最重要的三个子元素：
<div style="font-family: 微软雅黑; line-height: normal;">groupId:
定义了项目属于哪个组；比如，如果你的公司叫mycom，有一个项目叫myapp,那么一般groupId就应该是com.mycom.myapp
<div style="font-family: 微软雅黑; line-height: normal;">
artifactId:定义了当前Maven项目在组中的唯一ID，相当于子模块的定义
<div style="font-family: 微软雅黑; line-height: normal;">
version：定义了当前项目的当前版本，有SNAPSHOT的，一般是不稳定的版本
<div style="font-family: 微软雅黑; line-height: normal;">
最后，其实还可以加一个name元素，可以声明一个对用户更友好的项目名称)
<div style="font-family: 微软雅黑; line-height: normal;">
<div style="font-family: 微软雅黑; line-height: normal;">
这个应用将会有如图所示的结构，类似于普通的Maven Java项目：
<div style="font-family: 微软雅黑; line-height: normal;">
our-application-folder/
<blockquote style="font-family: 微软雅黑; line-height: normal; margin: 0px 0px 0px 40px; border: none; padding: 0px;">
├── pom.xml</blockquote>
<blockquote style="font-family: 微软雅黑; line-height: normal; margin: 0px 0px 0px 40px; border: none; padding: 0px;">
└── src</blockquote>
<blockquote style="font-family: 微软雅黑; line-height: normal; margin: 0px 0px 0px 40px; border: none; padding: 0px;">
<blockquote style="margin: 0px 0px 0px 40px; border: none; padding: 0px;">└──
main</blockquote>
</blockquote>
<blockquote style="font-family: 微软雅黑; line-height: normal; margin: 0px 0px 0px 40px; border: none; padding: 0px;">
<blockquote style="margin: 0px 0px 0px 40px; border: none; padding: 0px;">
<blockquote style="margin: 0px 0px 0px 40px; border: none; padding: 0px;">└──
java </blockquote>
</blockquote>
</blockquote>
<blockquote style="font-family: 微软雅黑; line-height: normal; margin: 0px 0px 0px 40px; border: none; padding: 0px;">
<blockquote style="margin: 0px 0px 0px 40px; border: none; padding: 0px;">
<blockquote style="margin: 0px 0px 0px 40px; border: none; padding: 0px;">| ├──
spouts</blockquote>
</blockquote>
</blockquote>
<blockquote style="font-family: 微软雅黑; line-height: normal; margin: 0px 0px 0px 40px; border: none; padding: 0px;">
<blockquote style="margin: 0px 0px 0px 40px; border: none; padding: 0px;">
<blockquote style="margin: 0px 0px 0px 40px; border: none; padding: 0px;">| └──
bolts</blockquote>
</blockquote>
</blockquote>
<blockquote style="font-family: 微软雅黑; line-height: normal; margin: 0px 0px 0px 40px; border: none; padding: 0px;">
<blockquote style="margin: 0px 0px 0px 40px; border: none; padding: 0px;">
<blockquote style="margin: 0px 0px 0px 40px; border: none; padding: 0px;">└──
resources</blockquote>
</blockquote>
</blockquote>
<div style="font-family: 微软雅黑; line-height: normal;">
在java下面的目录会包括所有我们的项目代码，我们需要处理的单词文件会放在resources目录下面
<div style="font-family: 微软雅黑; line-height: normal;">
<div style="font-family: 微软雅黑; line-height: normal;">
<b><u>创建我们第一个Topology</u></b>
<div style="font-family: 微软雅黑; line-height: normal;">
为了创建第一个topology，我们需要创建所有为了运行单词计数的类。在当前阶段，有些样例可能不是这么清楚，不过不要紧，我们会在今后的几章中说明。
<div style="font-family: 微软雅黑; line-height: normal;">
<div style="font-family: 微软雅黑; line-height: normal;">
<b><u>Spout</u></b>
<div style="font-family: 微软雅黑; line-height: normal;">WordReader
spout是实现了IRichSpout的类，在第四章会进一步的说明。WordReader负责读入文件，并将每一行提供给bolt。Spout通常emit定义好的字段清单。这样的结构允许我们对同一个spout流有不同类型的bolt来对应。
<div style="font-family: 微软雅黑; line-height: normal;">
Example2-1包含了这个类的完整代码，我们将会分析每一段代码。
<div style="font-family: 微软雅黑; line-height: normal;">
<div style="font-family: 微软雅黑; line-height: normal;">Example2-1
src/main/java/spouts/WordReader.java(本人用Eclipse新建了项目，和原书稍微有一点点区别，主要是package懒得改了）
<div style="font-family: 微软雅黑; line-height: normal;">
这里插一下，在Eclipse中选择文件-》新建-》项目，然后选中Maven
Project，选择quickstart，输入groupid和artifactid<img alt="Getting &lt;wbr&gt;Started &lt;wbr&gt;with &lt;wbr&gt;Storm(2)" data-inited="true" data-media-type="image" style="cursor: default; display: inline-block;" title="Getting &lt;wbr&gt;Started &lt;wbr&gt;with &lt;wbr&gt;Storm(2)"/>
<div style="font-family: 微软雅黑; line-height: normal;"><a href="http://album.sina.com.cn/pic/001DcOacgy6EY6PoOyNe5" target="_blank"><img alt="Getting &lt;wbr&gt;Started &lt;wbr&gt;with &lt;wbr&gt;Storm(2)" height="392" name="image_operate_63711386947300726" real_src="http://s6.sinaimg.cn/mw690/001DcOacgy6EY6PoOyNe5&amp;690" src="http://simg.sinajs.cn/blog7style/images/common/sg_trans.gif" title="Getting &lt;wbr&gt;Started &lt;wbr&gt;with &lt;wbr&gt;Storm(2)" width="490"/></a>
可以先生成一个空白的Maven项目，然后把
<div style="font-family: 微软雅黑; line-height: normal;">
<div style="font-family: 微软雅黑; line-height: normal;">package
storm.book.Getting_Started.spouts;
<div style="font-family: 微软雅黑; line-height: normal;">
<div style="font-family: 微软雅黑; line-height: normal;">import
java.io.BufferedReader;
<div style="font-family: 微软雅黑; line-height: normal;">import
java.io.FileNotFoundException;
<div style="font-family: 微软雅黑; line-height: normal;">import
java.io.FileReader;
<div style="font-family: 微软雅黑; line-height: normal;">import
java.util.Map;
<div style="font-family: 微软雅黑; line-height: normal;">import
backtype.storm.spout.SpoutOutputCollector;
<div style="font-family: 微软雅黑; line-height: normal;">import
backtype.storm.task.TopologyContext;
<div style="font-family: 微软雅黑; line-height: normal;">import
backtype.storm.topology.IRichSpout;
<div style="font-family: 微软雅黑; line-height: normal;">import
backtype.storm.topology.OutputFieldsDeclarer;
<div style="font-family: 微软雅黑; line-height: normal;">import
backtype.storm.tuple.Fields;
<div style="font-family: 微软雅黑; line-height: normal;">import
backtype.storm.tuple.Values;
<div style="font-family: 微软雅黑; line-height: normal;">
<div style="font-family: 微软雅黑; line-height: normal;">public class
WordReader implements IRichSpout {
<div style="font-family: 微软雅黑; line-height: normal;">
<div style="font-family: 微软雅黑; line-height: normal;">
private static final long serialVersionUID =
1L;
<div style="font-family: 微软雅黑; line-height: normal;">
private SpoutOutputCollector collector;
<div style="font-family: 微软雅黑; line-height: normal;">
private FileReader fileReader;
<div style="font-family: 微软雅黑; line-height: normal;">
private boolean completed = false;
<div style="font-family: 微软雅黑; line-height: normal;">
private TopologyContext context;
<div style="font-family: 微软雅黑; line-height: normal;">
public boolean isDistributed() {return
false;}
<div style="font-family: 微软雅黑; line-height: normal;">
public void ack(Object msgId) {
<div style="font-family: 微软雅黑; line-height: normal;">
System.out.println("OK:"+msgId);
<div style="font-family: 微软雅黑; line-height: normal;">
}
<div style="font-family: 微软雅黑; line-height: normal;">
public void close() {}
<div style="font-family: 微软雅黑; line-height: normal;">
public void fail(Object msgId) {
<div style="font-family: 微软雅黑; line-height: normal;">
System.out.println("FAIL:"+msgId);
<div style="font-family: 微软雅黑; line-height: normal;">
}
<div style="font-family: 微软雅黑; line-height: normal;">
<div style="font-family: 微软雅黑; line-height: normal;">
public void nextTuple() {
<div style="font-family: 微软雅黑; line-height: normal;">
<div style="font-family: 微软雅黑; line-height: normal;">
if(completed){
<div style="font-family: 微软雅黑; line-height: normal;">
try {
<div style="font-family: 微软雅黑; line-height: normal;">
Thread.sleep(1000);
<div style="font-family: 微软雅黑; line-height: normal;">
} catch (InterruptedException
e) {
<div style="font-family: 微软雅黑; line-height: normal;">
//Do nothing
<div style="font-family: 微软雅黑; line-height: normal;">
}
<div style="font-family: 微软雅黑; line-height: normal;">
return;
<div style="font-family: 微软雅黑; line-height: normal;">
}
<div style="font-family: 微软雅黑; line-height: normal;">
String str;
<div style="font-family: 微软雅黑; line-height: normal;">
//Open the reader
<div style="font-family: 微软雅黑; line-height: normal;">
BufferedReader reader = new
BufferedReader(fileReader);
<div style="font-family: 微软雅黑; line-height: normal;">
try{
<div style="font-family: 微软雅黑; line-height: normal;">
//Read all lines
<div style="font-family: 微软雅黑; line-height: normal;">
while((str =
reader.readLine()) != null){
<div style="font-family: 微软雅黑; line-height: normal;">
<div style="font-family: 微软雅黑; line-height: normal;">
this.collector.emit(new
Values(str),str);
<div style="font-family: 微软雅黑; line-height: normal;">
}
<div style="font-family: 微软雅黑; line-height: normal;">
}catch(Exception e){
<div style="font-family: 微软雅黑; line-height: normal;">
throw new
RuntimeException("Error reading tuple",e);
<div style="font-family: 微软雅黑; line-height: normal;">
}finally{
<div style="font-family: 微软雅黑; line-height: normal;">
completed = true;
<div style="font-family: 微软雅黑; line-height: normal;">
}
<div style="font-family: 微软雅黑; line-height: normal;">
}
<div style="font-family: 微软雅黑; line-height: normal;">
<div style="font-family: 微软雅黑; line-height: normal;">
public void open(Map conf, TopologyContext
context,
<div style="font-family: 微软雅黑; line-height: normal;">
SpoutOutputCollector
collector) {
<div style="font-family: 微软雅黑; line-height: normal;">
try {
<div style="font-family: 微软雅黑; line-height: normal;">
this.context = context;
<div style="font-family: 微软雅黑; line-height: normal;">
this.fileReader = new
FileReader(conf.get("wordsFile").toString());
<div style="font-family: 微软雅黑; line-height: normal;">
} catch (FileNotFoundException e) {
<div style="font-family: 微软雅黑; line-height: normal;">
throw new
RuntimeException("Error reading
file["+conf.get("wordFile")+"]");
<div style="font-family: 微软雅黑; line-height: normal;">
}
<div style="font-family: 微软雅黑; line-height: normal;">
this.collector = collector;
<div style="font-family: 微软雅黑; line-height: normal;">
}
<div style="font-family: 微软雅黑; line-height: normal;">
<div style="font-family: 微软雅黑; line-height: normal;">
public void
declareOutputFields(OutputFieldsDeclarer declarer) {
<div style="font-family: 微软雅黑; line-height: normal;">
declarer.declare(new Fields("line"));
<div style="font-family: 微软雅黑; line-height: normal;">
}
<div style="font-family: 微软雅黑; line-height: normal;">
//下面三行是无效的，在0.9.0.1的版本中是有如下几个抽象方法必须被实现的。
<div style="font-family: 微软雅黑; line-height: normal;">
<div style="font-family: 微软雅黑; line-height: normal;">}
<div style="font-family: 微软雅黑; line-height: normal;">
<div style="font-family: 微软雅黑; line-height: normal;">
第一，在任何一个Spout中第一个被调用的方法是public void open(Map conf, TopologyContext
context, SpoutOutputCollector
collector).接收的参数组包括TopologyContext，包含了我们所有的topology数据；conf对象，在topology定义中被创建；SpoutOutputCollector，允许我们emit数据，给到bolts。下面这段代码就是此方法的实装：
<div style="font-family: 微软雅黑; line-height: normal;">
public void open(Map conf, TopologyContext context,
SpoutOutputCollector collector) {
try {
this.context =
context;
this.fileReader = new
FileReader(conf.get("wordsFile").toString());
} catch (FileNotFoundException e) {
throw new
RuntimeException("Error reading
file["+conf.get("wordFile")+"]");
}
this.collector = collector;
}
<div style="font-family: 微软雅黑; line-height: normal;">
在这个方法中，我们也创建了一个reader，负责读入文件。
<div style="font-family: 微软雅黑; line-height: normal;">
<div style="font-family: 微软雅黑; line-height: normal;">
第二，我们需要实装pubilc void
nextTuple()，我们将在此方法中emit数据给到bolts。在现在这个例子中，此方法主要是读入文件然后按行emit数据
<div style="font-family: 微软雅黑; line-height: normal;">
public void nextTuple() {
if(completed){
try {
Thread.sleep(1000);
} catch
(InterruptedException e) {
}
return;
}
String str;
BufferedReader reader = new
BufferedReader(fileReader);
try{
while((str =
reader.readLine()) != null){
this.collector.emit(new Values(str),str);
}
}catch(Exception e){
throw new
RuntimeException("Error reading tuple",e);
}finally{
completed = true;
}
}
<div style="font-family: 微软雅黑; line-height: normal;">
注意，Values方法构筑了一个ArrayList的实例化。
<div style="font-family: 微软雅黑; line-height: normal;">
<div style="font-family: 微软雅黑; line-height: normal;">
nextTulpe()被间隙性地从同一个循环中被调用，比如ack（）和fail（）方法。如果已经没有工作要处理了，它必须释放对于线程的控制，以确保其他方法有机会被调用。所以第一行总是去检查看看处理是否已经完成了。如果是的话，就sleep至少1毫秒以降低cpu的负载。如果所有的工作都被完成的话，就是说一个文件的每一行都已经被读入赋值并emit出去。
<div style="font-family: 微软雅黑; line-height: normal;">
注意，Tuple是数据的被命名的list，可以是任何一种可以被序列化的java对象。Storm默认可以序列化包括string，byte
array，arraylist，hashmap和hashset类型。
<div style="font-family: 微软雅黑; line-height: normal;">
<div style="font-family: 微软雅黑; line-height: normal;">
<u><b>Bolts</b></u>
<div style="font-family: 微软雅黑; line-height: normal;">
我们现在已经有了一个spout，可以从一个文件中读取内容并把每一行emit一个tuple。接着我们需要创建2个bolt来处理这些tuple。这里，bolt会实装backtype.storm.topology.IRichBolt接口。
<div style="font-family: 微软雅黑; line-height: normal;">
<div style="font-family: 微软雅黑; line-height: normal;">最重要的方法是void
execute(Tuple
input),只要收到一个tuple此方法就会被调用一次。然后对于每一个接收到的tuple，此bolt会emit数个tuple。
<div style="font-family: 微软雅黑; line-height: normal;">
Bolt或者Spout可以根据需要emit多个tuple。当nextTuple或者execute方法被调用的时候，他们可以emit：0，1或者多个tuples。这一点，第五章还会详细阐述。
<div style="font-family: 微软雅黑; line-height: normal;">
<div style="font-family: 微软雅黑; line-height: normal;">
第一个bolt是WordNormalizer，负责把每一行内容正规化。它会把行切分成单词组，把所有单词小写化，并去掉首尾空格。
<div style="font-family: 微软雅黑; line-height: normal;">
1.我们需要声明bolt的输出参数：
<div style="font-family: 微软雅黑; line-height: normal;">public void
declareOutputFields(OutputFieldsDeclarer declarer) {
<div style="font-family: 微软雅黑; line-height: normal;">
declarer.declare(new Fields("word"));
<div style="font-family: 微软雅黑; line-height: normal;">}
<div style="font-family: 微软雅黑; line-height: normal;">
这里我们声明这个bolt会emit一个叫做“word"的字段。
<div style="font-family: 微软雅黑; line-height: normal;">2.我们需要实现public
void execute(Tuple input)方法，用来处理输入的tuples
<div style="font-family: 微软雅黑; line-height: normal;">public void
execute(Tuple input) {
<div style="font-family: 微软雅黑; line-height: normal;">String
sentence = input.getString(0);
<div style="font-family: 微软雅黑; line-height: normal;">String[] words
= sentence.split(" ");
<div style="font-family: 微软雅黑; line-height: normal;">for(String
word : words){
<div style="font-family: 微软雅黑; line-height: normal;">word =
word.trim();
<div style="font-family: 微软雅黑; line-height: normal;">
if(!word.isEmpty()){
<div style="font-family: 微软雅黑; line-height: normal;">word =
word.toLowerCase();
<div style="font-family: 微软雅黑; line-height: normal;">//Emit the
word
<div style="font-family: 微软雅黑; line-height: normal;">
collector.emit(new Values(word));
<div style="font-family: 微软雅黑; line-height: normal;">}
<div style="font-family: 微软雅黑; line-height: normal;">}
<div style="font-family: 微软雅黑; line-height: normal;">// Acknowledge
the tuple
<div style="font-family: 微软雅黑; line-height: normal;">
collector.ack(input);
<div style="font-family: 微软雅黑; line-height: normal;">}
<div style="font-family: 微软雅黑; line-height: normal;">
第一行从tuple中读取数据，可以按照位置或者名字读取。然后我们来处理读入的数据，最后用collector对象来emit数据。当每一个tuple都被处理之后，collector对象的ack()方法被调用表明处理已经被成功完成了。如果tuple没有被成功处理，需要调用collector对象的fail()对象。
<div style="font-family: 微软雅黑; line-height: normal;">
Example2-2包含了完整的代码：src/main/java/bolts/WordNormalizer.java
<div style="font-family: 微软雅黑; line-height: normal;">package
storm.book.Getting_Started.bolts;
<div style="font-family: 微软雅黑; line-height: normal;">import
java.util.ArrayList;
<div style="font-family: 微软雅黑; line-height: normal;">import
java.util.List;
<div style="font-family: 微软雅黑; line-height: normal;">import
java.util.Map;
<div style="font-family: 微软雅黑; line-height: normal;">import
backtype.storm.task.OutputCollector;
<div style="font-family: 微软雅黑; line-height: normal;">import
backtype.storm.task.TopologyContext;
<div style="font-family: 微软雅黑; line-height: normal;">import
backtype.storm.topology.IRichBolt;
<div style="font-family: 微软雅黑; line-height: normal;">import
backtype.storm.topology.OutputFieldsDeclarer;
<div style="font-family: 微软雅黑; line-height: normal;">import
backtype.storm.tuple.Fields;
<div style="font-family: 微软雅黑; line-height: normal;">import
backtype.storm.tuple.Tuple;
<div style="font-family: 微软雅黑; line-height: normal;">import
backtype.storm.tuple.Values;
<div style="font-family: 微软雅黑; line-height: normal;">public class
WordNormalizer implements IRichBolt {
<div style="font-family: 微软雅黑; line-height: normal;">
<div style="font-family: 微软雅黑; line-height: normal;">
private static final long serialVersionUID =
1L;
<div style="font-family: 微软雅黑; line-height: normal;">
private OutputCollector collector;
<div style="font-family: 微软雅黑; line-height: normal;">
public void cleanup() {}
<div style="font-family: 微软雅黑; line-height: normal;">
<div style="font-family: 微软雅黑; line-height: normal;">
public void execute(Tuple input) {
<div style="font-family: 微软雅黑; line-height: normal;">
String sentence = input.getString(0);
<div style="font-family: 微软雅黑; line-height: normal;">
String[] words = sentence.split(" ");
<div style="font-family: 微软雅黑; line-height: normal;">
for(String word : words){
<div style="font-family: 微软雅黑; line-height: normal;">
word = word.trim();
<div style="font-family: 微软雅黑; line-height: normal;">
if(!word.isEmpty()){
<div style="font-family: 微软雅黑; line-height: normal;">
word =
word.toLowerCase();
<div style="font-family: 微软雅黑; line-height: normal;">
//Emit the word
<div style="font-family: 微软雅黑; line-height: normal;">
List a = new
ArrayList();
<div style="font-family: 微软雅黑; line-height: normal;">
a.add(input);
<div style="font-family: 微软雅黑; line-height: normal;">
collector.emit(a,new
Values(word));
<div style="font-family: 微软雅黑; line-height: normal;">
}
<div style="font-family: 微软雅黑; line-height: normal;">
}
<div style="font-family: 微软雅黑; line-height: normal;">
// Acknowledge the tuple
<div style="font-family: 微软雅黑; line-height: normal;">
collector.ack(input);
<div style="font-family: 微软雅黑; line-height: normal;">
}
<div style="font-family: 微软雅黑; line-height: normal;">
public void prepare(Map stormConf,
TopologyContext context,
<div style="font-family: 微软雅黑; line-height: normal;">
OutputCollector collector)
{
<div style="font-family: 微软雅黑; line-height: normal;">
this.collector = collector;
<div style="font-family: 微软雅黑; line-height: normal;">
}
<div style="font-family: 微软雅黑; line-height: normal;">
<div style="font-family: 微软雅黑; line-height: normal;">
public void
declareOutputFields(OutputFieldsDeclarer declarer) {
<div style="font-family: 微软雅黑; line-height: normal;">
declarer.declare(new Fields("word"));
<div style="font-family: 微软雅黑; line-height: normal;">
}
<div style="font-family: 微软雅黑; line-height: normal;">
//public Map getComponentConfiguration(){return
new java.util.HashMap();}
<div style="font-family: 微软雅黑; line-height: normal;">}
<div style="font-family: 微软雅黑; line-height: normal;">
在这个类中，我们看到了在一个execute调用中emit了多个tuples。如果此方法接收到了一个句子“This is the
Storm book",我们的这个execute方法会emit5个新的tuple
<div style="font-family: 微软雅黑; line-height: normal;">
<div style="font-family: 微软雅黑; line-height: normal;">
然后我们来看一下下一个bolt，WordCounter，负责对单词计数。当topology完成时（也就是cleanup()方法被调用的时候），我们将显示每个单词的个数
<div style="font-family: 微软雅黑; line-height: normal;">
这里是个简单的bolt的例子，没有emit任何东西，只是简单把数据加入到一个map，而事实上经常会把数据存储到数据库。
<div style="font-family: 微软雅黑; line-height: normal;">package
storm.book.Getting_Started.bolts;
<div style="font-family: 微软雅黑; line-height: normal;">import
java.util.HashMap;
<div style="font-family: 微软雅黑; line-height: normal;">import
java.util.Map;
<div style="font-family: 微软雅黑; line-height: normal;">import
backtype.storm.task.OutputCollector;
<div style="font-family: 微软雅黑; line-height: normal;">import
backtype.storm.task.TopologyContext;
<div style="font-family: 微软雅黑; line-height: normal;">import
backtype.storm.topology.IRichBolt;
<div style="font-family: 微软雅黑; line-height: normal;">import
backtype.storm.topology.OutputFieldsDeclarer;
<div style="font-family: 微软雅黑; line-height: normal;">import
backtype.storm.tuple.Tuple;
<div style="font-family: 微软雅黑; line-height: normal;">public class
WordCounter implements IRichBolt {
<div style="font-family: 微软雅黑; line-height: normal;">
<div style="font-family: 微软雅黑; line-height: normal;">
private static final long serialVersionUID =
8620547231572082101L;
<div style="font-family: 微软雅黑; line-height: normal;">
Integer id;
<div style="font-family: 微软雅黑; line-height: normal;">
String name;
<div style="font-family: 微软雅黑; line-height: normal;">
ap counters;
<div style="font-family: 微软雅黑; line-height: normal;">
private OutputCollector collector;
<div style="font-family: 微软雅黑; line-height: normal;">
<div style="font-family: 微软雅黑; line-height: normal;">
<div style="font-family: 微软雅黑; line-height: normal;">
public void cleanup() {
<div style="font-family: 微软雅黑; line-height: normal;">
System.out.println("-- Word Counter
["+name+"-"+id+"] --");
<div style="font-family: 微软雅黑; line-height: normal;">
for(Map.Entry entry :
counters.entrySet()){
<div style="font-family: 微软雅黑; line-height: normal;">
System.out.println(entry.getKey()+":
"+entry.getValue());
<div style="font-family: 微软雅黑; line-height: normal;">
}
<div style="font-family: 微软雅黑; line-height: normal;">
}
<div style="font-family: 微软雅黑; line-height: normal;">
<div style="font-family: 微软雅黑; line-height: normal;">
<div style="font-family: 微软雅黑; line-height: normal;">
public void execute(Tuple input) {
<div style="font-family: 微软雅黑; line-height: normal;">
String str = input.getString(0);
<div style="font-family: 微软雅黑; line-height: normal;">
<div style="font-family: 微软雅黑; line-height: normal;">
if(!counters.containsKey(str)){
<div style="font-family: 微软雅黑; line-height: normal;">
counters.put(str, 1);
<div style="font-family: 微软雅黑; line-height: normal;">
}else{
<div style="font-family: 微软雅黑; line-height: normal;">
Integer c = counters.get(str)
+ 1;
<div style="font-family: 微软雅黑; line-height: normal;">
counters.put(str, c);
<div style="font-family: 微软雅黑; line-height: normal;">
}
<div style="font-family: 微软雅黑; line-height: normal;">
//Set the tuple as Acknowledge
<div style="font-family: 微软雅黑; line-height: normal;">
collector.ack(input);
<div style="font-family: 微软雅黑; line-height: normal;">
}
<div style="font-family: 微软雅黑; line-height: normal;">
<div style="font-family: 微软雅黑; line-height: normal;">
<div style="font-family: 微软雅黑; line-height: normal;">
public void prepare(Map stormConf,
TopologyContext context,
<div style="font-family: 微软雅黑; line-height: normal;">
OutputCollector collector)
{
<div style="font-family: 微软雅黑; line-height: normal;">
this.counters = new HashMap();
<div style="font-family: 微软雅黑; line-height: normal;">
this.collector = collector;
<div style="font-family: 微软雅黑; line-height: normal;">
this.name = context.getThisComponentId();
<div style="font-family: 微软雅黑; line-height: normal;">
this.id = context.getThisTaskId();
<div style="font-family: 微软雅黑; line-height: normal;">
}
<div style="font-family: 微软雅黑; line-height: normal;">
<div style="font-family: 微软雅黑; line-height: normal;">
public void
declareOutputFields(OutputFieldsDeclarer declarer) {}
<div style="font-family: 微软雅黑; line-height: normal;">
//public Map getComponentConfiguration(){return
new java.util.HashMap();}
<div style="font-family: 微软雅黑; line-height: normal;">}
<div style="font-family: 微软雅黑; line-height: normal;">
execute方法是用一个map对象来收集和计算单词的个数。当这个topology终止的时候，cleanup()方法被调用，并打印这个counter
map（这只是一个例子，通常你需要在cleanup()调用的时候去关闭活动的连接，释放资源）
<div style="font-family: 微软雅黑; line-height: normal;">
<div style="font-family: 微软雅黑; line-height: normal;">
<u><b>Main类</b></u>
<div style="font-family: 微软雅黑; line-height: normal;">
在main类中，你将会创建一个topology和一个LocalCluster的对象，从而可以在本地测试和debug这个topology。通过和Config对象的联系，LocalCluster允许你尝试不同的cluster配置。比如，如果一个全局或者类变量被偶然使用，你可以通过改变配置使用不同数量的worker节点测试的时候发现错误。（在第三章会详细介绍）
<div style="font-family: 微软雅黑; line-height: normal;">
<div style="font-family: 微软雅黑; line-height: normal;">
所有的topology节点都需要能够在没有任何进程间共享数据的情况下运行，因为在实际的cluster中，这些进程会运行在不同的机器上。
<div style="font-family: 微软雅黑; line-height: normal;">
<div style="font-family: 微软雅黑; line-height: normal;">
你将会使用TopologyBuilder来创建一个topology，然后告诉Storm如何来安置这个节点，怎么样来交换数据。
<div style="font-family: 微软雅黑; line-height: normal;">
TopologyBuilder builder = new TopologyBuilder();
<div style="font-family: 微软雅黑; line-height: normal;">
builder.setSpout("word-reader",new WordReader());
<div style="font-family: 微软雅黑; line-height: normal;">
builder.setBolt("word-normalizer", new
WordNormalizer()).shuffleGrouping("word-
<div style="font-family: 微软雅黑; line-height: normal;">
reader");
<div style="font-family: 微软雅黑; line-height: normal;">
builder.setBolt("word-counter", new
WordCounter()).shuffleGrouping("word-
<div style="font-family: 微软雅黑; line-height: normal;">
normalizer");
<div style="font-family: 微软雅黑; line-height: normal;">
Spout和blot使用shuffleGrouping联系在一起。这种类型的组合告诉Strom自由地从源节点发送信息到目标节点。
<div style="font-family: 微软雅黑; line-height: normal;">
<div style="font-family: 微软雅黑; line-height: normal;">
然后，创建一个包含了topology配置的Config对象，这个对象会在运行的时候和cluster的配置整合在一起，然后通过prepare方法发送给所有的节点。
<div style="font-family: 微软雅黑; line-height: normal;">Config conf =
new Config();
<div style="font-family: 微软雅黑; line-height: normal;">
conf.put("wordsFile", args[0]);
<div style="font-family: 微软雅黑; line-height: normal;">
conf.setDebug(true);
<div style="font-family: 微软雅黑; line-height: normal;">
在开发环境中，设置wordsFile文件为会被spout读入的文件名，设置debug为true。当debug是true的时候，Storm会打印所有的节点之间交换数据的信息，以及其他对理解topology怎么运行的有用的信息。
<div style="font-family: 微软雅黑; line-height: normal;">
<div style="font-family: 微软雅黑; line-height: normal;">
正如前面解释的，你需要使用LocalCluster来运行这个cluster。在生产环境中，topology将会持续运行。不过在这个例子中，你将近运行这个topology几秒钟以便于看到结果。
<div style="font-family: 微软雅黑; line-height: normal;">LocalCluster
cluster = new LocalCluster();
<div style="font-family: 微软雅黑; line-height: normal;">
cluster.submitTopology("Getting-Started-Toplogie", conf,
builder.createTopology());
<div style="font-family: 微软雅黑; line-height: normal;">
Thread.sleep(2000);
<div style="font-family: 微软雅黑; line-height: normal;">
cluster.shutdown();
<div style="font-family: 微软雅黑; line-height: normal;">
使用createTopology和submitTopology来创建并运行topology，sleep2秒（topology在不同的线程中运行），然后通过停止cluster来终止topology。
<div style="font-family: 微软雅黑; line-height: normal;">
<div style="font-family: 微软雅黑; line-height: normal;">Example2-3
src/main/java/TopologyMain.java
<div style="font-family: 微软雅黑; line-height: normal;">import
spouts.WordReader;
<div style="font-family: 微软雅黑; line-height: normal;">import
backtype.storm.Config;
<div style="font-family: 微软雅黑; line-height: normal;">import
backtype.storm.LocalCluster;
<div style="font-family: 微软雅黑; line-height: normal;">import
backtype.storm.topology.TopologyBuilder;
<div style="font-family: 微软雅黑; line-height: normal;">import
backtype.storm.tuple.Fields;
<div style="font-family: 微软雅黑; line-height: normal;">import
bolts.WordCounter;
<div style="font-family: 微软雅黑; line-height: normal;">import
bolts.WordNormalizer;
<div style="font-family: 微软雅黑; line-height: normal;">public class
TopologyMain {
<div style="font-family: 微软雅黑; line-height: normal;">public static
void main(String[] args) throws InterruptedException {
<div style="font-family: 微软雅黑; line-height: normal;">//Topology
definition
<div style="font-family: 微软雅黑; line-height: normal;">
TopologyBuilder builder = new TopologyBuilder();
<div style="font-family: 微软雅黑; line-height: normal;">
builder.setSpout("word-reader",new WordReader());
<div style="font-family: 微软雅黑; line-height: normal;">
builder.setBolt("word-normalizer", new WordNormalizer())
<div style="font-family: 微软雅黑; line-height: normal;">
.shuffleGrouping("word-reader");
<div style="font-family: 微软雅黑; line-height: normal;">
builder.setBolt("word-counter", new WordCounter(),2)
<div style="font-family: 微软雅黑; line-height: normal;">
.fieldsGrouping("word-normalizer", new Fields("word"));
<div style="font-family: 微软雅黑; line-height: normal;">
//Configuration
<div style="font-family: 微软雅黑; line-height: normal;">Config conf =
new Config();
<div style="font-family: 微软雅黑; line-height: normal;">
conf.put("wordsFile", args[0]);
<div style="font-family: 微软雅黑; line-height: normal;">
conf.setDebug(false);
<div style="font-family: 微软雅黑; line-height: normal;">//Topology
run
<div style="font-family: 微软雅黑; line-height: normal;">
conf.put(Config.TOPOLOGY_MAX_SPOUT_PENDING, 1);
<div style="font-family: 微软雅黑; line-height: normal;">LocalCluster
cluster = new LocalCluster();
<div style="font-family: 微软雅黑; line-height: normal;">
cluster.submitTopology("Getting-Started-Toplogie", conf,
<div style="font-family: 微软雅黑; line-height: normal;">
builder.createTopology());
<div style="font-family: 微软雅黑; line-height: normal;">
Thread.sleep(1000);
<div style="font-family: 微软雅黑; line-height: normal;">
cluster.shutdown();
<div style="font-family: 微软雅黑; line-height: normal;">}
<div style="font-family: 微软雅黑; line-height: normal;">}
<div style="font-family: 微软雅黑; line-height: normal;">
<div style="font-family: 微软雅黑; line-height: normal;">
<u><b>让我们来执行～</b></u>
<div style="font-family: 微软雅黑; line-height: normal;">
我们可以来运行第一个topology了！我们在src/main/resources/words.txt中在每一行创建一个单词，比如：
<div style="font-family: 微软雅黑; line-height: normal;">Storm
<div style="font-family: 微软雅黑; line-height: normal;">test
<div style="font-family: 微软雅黑; line-height: normal;">are
<div style="font-family: 微软雅黑; line-height: normal;">great
<div style="font-family: 微软雅黑; line-height: normal;">is
<div style="font-family: 微软雅黑; line-height: normal;">an
<div style="font-family: 微软雅黑; line-height: normal;">Storm
<div style="font-family: 微软雅黑; line-height: normal;">simple
<div style="font-family: 微软雅黑; line-height: normal;">
application
<div style="font-family: 微软雅黑; line-height: normal;">but
<div style="font-family: 微软雅黑; line-height: normal;">very
<div style="font-family: 微软雅黑; line-height: normal;">powerful
<div style="font-family: 微软雅黑; line-height: normal;">really
<div style="font-family: 微软雅黑; line-height: normal;">Storm
<div style="font-family: 微软雅黑; line-height: normal;">is
<div style="font-family: 微软雅黑; line-height: normal;">great
<div style="font-family: 微软雅黑; line-height: normal;">
然后到pom.xml所在的目录运行Maven的命令：
<div style="font-family: 微软雅黑; line-height: normal;">mvn exec:java
-Dexec.mainClass="storm.book.Getting_Started.TopologyMain"
-Dexec.args="src/main/resources/
<div style="font-family: 微软雅黑; line-height: normal;">
words.txt"
<div style="font-family: 微软雅黑; line-height: normal;">
<div style="font-family: 微软雅黑; line-height: normal;">
然后你可以在log中找到如下的内容：
<div style="font-family: 微软雅黑; line-height: normal;">1902
[Thread-24] INFO backtype.storm.util - Async loop
interrupted!
<div style="font-family: 微软雅黑; line-height: normal;">-- Word
Counter [word-counter-3] --
<div style="font-family: 微软雅黑; line-height: normal;">really:
1
<div style="font-family: 微软雅黑; line-height: normal;">but: 1
<div style="font-family: 微软雅黑; line-height: normal;">great: 2
<div style="font-family: 微软雅黑; line-height: normal;">an: 1
<div style="font-family: 微软雅黑; line-height: normal;">storm: 3
<div style="font-family: 微软雅黑; line-height: normal;">1907
[storm.book.Getting_Started.TopologyMain.main()] INFO
backtype.storm.daemon.task - Shut down task
Getting-Started-Toplogie-1-1386945629:3
<div style="font-family: 微软雅黑; line-height: normal;">1907
[storm.book.Getting_Started.TopologyMain.main()] INFO
backtype.storm.daemon.task - Shutting down task
Getting-Started-Toplogie-1-1386945629:2
<div style="font-family: 微软雅黑; line-height: normal;">1907
[Thread-26] INFO backtype.storm.util - Async loop
interrupted!
<div style="font-family: 微软雅黑; line-height: normal;">-- Word
Counter [word-counter-2] --
<div style="font-family: 微软雅黑; line-height: normal;">application:
1
<div style="font-family: 微软雅黑; line-height: normal;">is: 2
<div style="font-family: 微软雅黑; line-height: normal;">are: 1
<div style="font-family: 微软雅黑; line-height: normal;">test: 1
<div style="font-family: 微软雅黑; line-height: normal;">simple:
1
<div style="font-family: 微软雅黑; line-height: normal;">powerful:
1
<div style="font-family: 微软雅黑; line-height: normal;">very: 1
<div style="font-family: 微软雅黑; line-height: normal;">
<div style="font-family: 微软雅黑; line-height: normal;">注意我们代码中的
<div style="font-family: 微软雅黑; line-height: normal;">
builder.setBolt("word-counter", new WordCounter(),2)
<div style="font-family: 微软雅黑; line-height: normal;">
.shuffleGrouping("word-normalizer");
<div style="font-family: 微软雅黑; line-height: normal;">
这是创建了2个WordCounter节点。这就是我们并行化WordCounter的秘诀。
<div style="font-family: 微软雅黑; line-height: normal;">
<div style="font-family: 微软雅黑; line-height: normal;">
不可思议吧，这么简单就可以创造出并行机制（在实际中，每个实例都会跑在独立的机器上）不过再仔细看一下，你就会发觉，is和great在每个WordCounter的实例中都被计算了一次。为什么呢？当你使用shuffleGrouping的时候，你是告诉Storm使用随机的方式发送每一个消息。在这个例子中，最理想的是总是发送同一个单词到同一个WordCounter。为了实现这个，你可以把shuffleGrouping改成fieldGrouping("word-normalizer",new
Fields("word")).然后让我们再尝试一下吧。在后面几张你会看到更多的分组和信息流。
<div style="font-family: 微软雅黑; line-height: normal;">
<div style="font-family: 微软雅黑; line-height: normal;">
<u><b><font style="font-size: 16px;">结论:</font></b></u>
<div style="font-family: 微软雅黑; line-height: normal;">
我们讨论了Strom的Local和Remote操作模式的区别，Storm的威力以及开发的易用性。你也了解了一些Strom的基础概念，在随后的章节中会深入说明。
    </div>

    
    
    

    <footer class="post-footer">
          <div class="reward-container">
  <div>一杯清茶</div>
  <button onclick="document.querySelector('.post-reward').classList.toggle('active');">
    赞赏
  </button>
  <div class="post-reward">
      <div>
        <img src="/images/wechatpay.png" alt="Ryle Liu 微信">
        <span>微信</span>
      </div>
      <div>
        <img src="/images/alipay.png" alt="Ryle Liu 支付宝">
        <span>支付宝</span>
      </div>

  </div>
</div>

          

<div class="post-copyright">
<ul>
  <li class="post-copyright-author">
      <strong>本文作者： </strong>Ryle Liu
  </li>
  <li class="post-copyright-link">
      <strong>本文链接：</strong>
      <a href="https://www.liuyong.online/2013/12/13/Getting%C2%A0Started%C2%A0with%C2%A0Storm(2)/" title="Getting Started with Storm(2)">https://www.liuyong.online/2013/12/13/Getting Started with Storm(2)/</a>
  </li>
  <li class="post-copyright-license">
    <strong>版权声明： </strong>本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/zh" rel="noopener" target="_blank"><i class="fab fa-fw fa-creative-commons"></i>BY-NC-SA</a> 许可协议。转载请注明出处！
  </li>
</ul>
</div>

          

  <div class="followme">
    <span>欢迎关注我的其它发布渠道</span>

    <div class="social-list">

        <div class="social-item">
          <a target="_blank" class="social-link" href="/atom.xml">
            <span class="icon">
              <i class="fa fa-rss"></i>
            </span>

            <span class="label">RSS</span>
          </a>
        </div>

        <div class="social-item">
          <a target="_blank" class="social-link" href="https://www.liu.group">
            <span class="icon">
              <i class="fa fa-thumbs-up"></i>
            </span>

            <span class="label">WEB</span>
          </a>
        </div>
    </div>
  </div>

          <div class="post-tags">
              <a href="/tags/storm/" rel="tag"><i class="fa fa-tag"></i> storm</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2013/12/16/Getting%C2%A0Started%C2%A0with%C2%A0Storm(3)/" rel="prev" title="Getting Started with Storm(3)">
                  <i class="fa fa-chevron-left"></i> Getting Started with Storm(3)
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/2013/12/07/Netbeans7.4+XAMPP+Xdebug@Ubuntu1204LTS/" rel="next" title="Netbeans7.4+XAMPP+Xdebug@Ubuntu1204LTS">
                  Netbeans7.4+XAMPP+Xdebug@Ubuntu1204LTS <i class="fa fa-chevron-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






      

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      const activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      const commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

    </div>
  </main>

  <footer class="footer">
    <div class="footer-inner">
      

      

<div class="wordcount">
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-line"></i>
    </span>
      <span>站点总字数：</span>
    <span title="站点总字数">221k</span>
  </span>
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
      <span>站点阅读时长 &asymp;</span>
    <span title="站点阅读时长">3:21</span>
  </span>
<!-- </div> -->
<!-- <div class="busuanzi-count"> -->
    <span class="post-meta-item" id="busuanzi_container_site_uv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="总访客量">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-item" id="busuanzi_container_site_pv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="总访问量">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
<!-- </div> -->

</div>

<div class="copyright">
  
  &copy; 2009 – 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Ryle Liu</span>
  <span class="post-meta-item">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/muse/" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a> 强力驱动
  </span>
</div>

    </div>
  </footer>

  
  <script src="//cdn.jsdelivr.net/npm/animejs@3.2.0/lib/anime.min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.js"></script>
<script src="/js/utils.js"></script><script src="/js/schemes/muse.js"></script><script src="/js/next-boot.js"></script>

  
  <script>
    (function(){
      var bp = document.createElement('script');
      var curProtocol = window.location.protocol.split(':')[0];
      bp.src = (curProtocol === 'https') ? 'https://zz.bdstatic.com/linksubmit/push.js' : 'http://push.zhanzhang.baidu.com/push.js';
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(bp, s);
    })();
  </script>




  <script src="/js/local-search.js"></script>















  
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>








  

  

</body>
</html>
